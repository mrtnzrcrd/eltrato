<section data-ng-controller="IndexController">
<toaster-container ng-if="toasterGeneral" toaster-options="{'time-out': 3000}"></toaster-container>
<alert ng-if="alertOk" ng-repeat="alert in alerts" type="alert.type" close="closeAlert($index)">
    <h4>{{alert.title}}</h4>
    {{alert.msg}}
</alert>
<div class="col-md-12">
    <img class="imgLoading" src="../img/icons/ajax-loader.gif" ng-if="loading">
    <h4 class="textLoading" ng-if="loading">
        <span class="label label-info">Esperando ubicación</span>
    </h4>
</div>
<div class="col-xs-12 parent" ng-if="search">
    <div class="col-xs-6 col-centered">
        <h1 style="text-align: center;">elTrato</h1>
    </div>
    <div class="col-xs-8 col-centered">
        <form class="navbar-form" role="search" name="search-form" data-ng-submit="buscar()">
            <div class="col-centered col-md-6" style="margin-bottom: 10px;">
                <input class="placeCenter form-control" type="text" ng-model="asyncSelected"
                       placeholder="Donde buscamos?"
                       typeahead="address
                for address in getLocationViaGoogle($viewValue) | filter:$viewValue"
                       typeahead-loading="loadingLocations"
                       class="form-control">
                <i ng-show="loadingLocations" class="glyphicon glyphicon-refresh"></i>
            </div>
            <div class="input-group">
                <input data-ng-model="q" type="text" class="form-control input-lg" value="">

                <div class="input-group-btn">
                    <button type="submit" class="btn btn-primary btn-lg"><span
                            class="glyphicon glyphicon-search"></span></button>
                </div>
            </div>
            <input type="hidden" ng-value="lat" id="inputLat" name="lat">
            <input type="hidden" ng-value="lng" id="inputLng" name="lng">
        </form>
    </div>
</div>
<div class="col-xs-12 parent" ng-if="yesAd">
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="navbar-collapse">
                <div class="col-md-4" style="margin-left: -30px;" ng-if="!global.authenticated">
                    <form class="navbar-form navbar-left" role="search" ng-submit="formTags()">
                        <div class="input-group">
                            <input value="" type="text" class="form-control" ng-change="newTag(tagsHeader)"
                                   ng-value="tagsHeader" ng-model="tagsHeader" placeholder="Realiza tu busqueda..">

                            <div class="input-group-btn">
                                <button type="submit" class="btn btn-primary"><span
                                        class="glyphicon glyphicon-search"></span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="col-md-4">
                    <form class="navbar-form navbar-left" role="search" ng-submit="localizacion()">
                        <div class="input-group">
                            <input type="text" ng-value="address" ng-model="address" typeahead="address
                for address in getLocationViaGoogle($viewValue) | filter:$viewValue"
                                   typeahead-loading="loadingLocations" placeholder="Filtra por ubicación..."
                                   class="form-control">

                            <div class="input-group-btn">
                                <button type="submit" class="btn btn-primary"><span
                                        class="glyphicon glyphicon-map-marker"></span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <ul class="nav navbar-nav">
                    <li>
                        <div class="col-md-12">
                            <input style="margin-top: 10px;" type="range" data-ng-model="kilometros"
                                   tooltip="Buscar en {{kilometros}} km" min="0" max="140" step="20"
                                   ng-value="kilometros" data-ng-change="distance(kilometros)"/>

                            <p ng-if="!pais" style="text-align: center; margin-top: 5px;">En {{kilometros}} km</p>
                        </div>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Precio<b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <form class="navbar-form navbar-left" role="search" ng-submit="price()">
                                <li>
                                    <div style="text-align: center; margin-bottom: 7px;">
                                        <input type="number" ng-model="desde"
                                               class="placeCenter form-control"
                                               placeholder="Desde"
                                               my-input>
                                    </div>
                                </li>
                                <li>
                                    <div style="text-align: center;">
                                        <input type="number" ng-model="hasta"
                                               class="placeCenter form-control"
                                               placeholder="Hasta"
                                               my-input>
                                    </div>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <div style="text-align: center">
                                        <button type="submit" class="btn btn-primary">Buscar</button>
                                    </div>
                                </li>
                            </form>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Más<b
                                class="caret"></b></a>
                        <ul class="dropdown-menu" style="right: 0; left: auto; width: 400px;">
                            <form class="navbar-form navbar-left" role="search" ng-submit="price()">
                                <li>
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="optionsRadios" id="optionsRadios1"
                                                   value="option1">
                                            Mostrar solo usuarios que acepten contraofertas o trueques
                                        </label>
                                    </div>
                                </li>
                                <li>
                                    <div style="text-align: center;">
                                        <input type="number" ng-model="hasta"
                                               class="placeCenter form-control"
                                               placeholder="Hasta"
                                               my-input>
                                    </div>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <div style="text-align: center">
                                        <button type="submit" class="btn btn-primary">Buscar</button>
                                    </div>
                                </li>
                            </form>
                        </ul>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
    <div class="row">
        <div class="col-md-3 col-lg-offset-3">
            <p>Encontrados {{results}} tratos</p>
        </div>
        <div class="col-md-3 col-lg-offset-3">
            <label style="float: right;">
                <span class="glyphicon glyphicon-info-sign"
                      popover="Cuando veas esta etiqueta significara que ese trato puede recibir contraofertas, otros articulos
                      como forma de pago o trueques " popover-trigger="mouseenter" popover-placement="bottom"></span>
                <img src="../img/icons/tratoInfo.png" width="50px">
            </label>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <div class="panel panel-primary">
                <!-- Default panel contents -->
                <div class="panel-heading">Lo más buscado</div>

                <!-- List group -->
                <ul class="list-group">
                    <li class="list-group-item">#1 Cras justo odio</li>
                    <li class="list-group-item">Dapibus ac facilisis in</li>
                    <li class="list-group-item">Morbi leo risus</li>
                    <li class="list-group-item">Porta ac consectetur ac</li>
                    <li class="list-group-item">Vestibulum at eros</li>
                </ul>
            </div>
        </div>
        <div class="col-md-9">
            <div class="row" ng-repeat="row in anuncios | inSlicesOf:2">
                <div class="col-xs-6 col-sm-6" data-ng-repeat="anuncio in row">
                    <div class="thumbnail">
                        <div style="height: 13em; background-image: url({{anuncio.images[0]}});" class="imagenAnuncio">
                            <a href="{{anuncio}}" data-ng-click="view($event, anuncio)">
                                <div class="row">
                                    <div class="col-md-7">
                                        <span data-ng-repeat="tag in anuncio.tags" class="label label-primary pull-left"
                                              style="font-size: initial; margin: 2px;">{{tag}}</span>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <span class="label label-default pull-right"
                                                      am-time-ago="anuncio.created"></span>
                                            </div>
                                        </div>
                                        <div class="row" data-ng-repeat="trueque in anuncio.opciones" ng-switch
                                             on="trueque.trueque">
                                            <img src="../img/icons/trato.png" width="50px"
                                                 style="float: right; margin-right: 15px;">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12"style="height: 8em; margin-bottom: 10px">

                                </div>
                            </a>
                        </div>
                        <div class="caption">
                            <div class="row">
                                <div class="col-md-10">
                                    <a href="#" class="btn btn-message btn-sm" role="button" tooltip="Enviar mensaje">
                                        <span class="glyphicon glyphicon-envelope"></span>
                                    </a>
                                    <a href="#" class="btn btn-deal btn-sm" role="button" tooltip="Contraoferta"
                                       data-ng-repeat="trueque in anuncio.opciones" ng-switch on="trueque.trueque">
                                        <span class="glyphicon glyphicon-transfer"></span> Contraoferta
                                    </a>
                                    <a class="btn btn-favorite btn-sm" role="button" ng-click="favoritosGeneral(anuncio)"
                                       tooltip="Añadir a favoritos">
                                        <span class="glyphicon glyphicon-star-empty"></span>
                                    </a>
                                    <a href="#" class="btn btn-phone btn-sm" role="button"
                                       tooltip="Teléfono">
                                        <span class="glyphicon glyphicon-earphone"></span>
                                    </a>
                                    <a href="#" class="btn btn-complaint btn-sm" role="button" tooltip="Denunciar trato">
                                        <span class="glyphicon glyphicon-thumbs-down"></span>
                                    </a>
                                </div>
                                <div class="col-md-2">
                                    <div class="row">
                                        <span style="float: right; margin-right: 15px; font-size: initial;"
                                              class="label label-primary">{{anuncio.precio}}€</span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12" style="margin-top: 8px;">
                                    <p>{{anuncio.descripcion}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/ng-template" id="myModalContent.html">
    <div class="modal-header">
        <div class="row">
            <div class="col-md-9">
                <span data-ng-repeat="tag in tratos.tags" class="label label-primary pull-left"
                      style="font-size: initial; margin: 2px;">{{tag}}</span>
            </div>
            <div class="col-md-3">
                <button style="float: right; margin-right: 15px;" ng-click="cancel()" type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <span style="float: right; margin-right: 15px; font-size: initial;"
                      class="label label-primary">{{tratos.precio}}€</span>
            </div>
        </div>
    </div>
    <div class="modal-body">
        <toaster-container toaster-options="{'time-out': 3000}"></toaster-container>
        <div class="row">
            <div class="col-md-6">
                <div data-ng-repeat="images in tratos.images">
                    <div class="row" ng-if="$index == 0">
                        <div class="col-md-12">
                            <a href ng-click="show_dialog()">
                                <div class="thumbnail" style="margin-bottom: 7px;">
                                    <img alt="{{images}}" src="{{images}}" class="img-circle">
                                </div>
                            </a>
                        </div>
                    </div>
                    <div class="col-md-4" style="padding-left: 0;" ng-if="$index != 0">
                        <a href ng-click="show_dialog()">
                            <div class="thumbnail">
                                <img src="{{images}}" class="img-circle" style="height: 4em">
                            </div>
                        </a>
                    </div>
                    <div class="wrapper">
                        <div class="future_fancybox_content">
                            <img class="fancybox-image" src="{{images}}">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-6">
                        <span class="label label-default">{{address}}</span>
                    </div>
                    <div class="col-md-6">
                            <span class="label label-default pull-right"
                                  am-time-ago="tratos.created"></span>
                    </div>
                </div>
                <div class="row" style="height: 13.5em">
                    <div class="col-md-12">
                        <h4>{{tratos.descripcion}}</h4>
                    </div>
                </div>
                <div class="row">
                    {{tratos.user.username}}
                </div>
            </div>
        </div>
    </div>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn btn-message" role="button" title="Enviar mensaje">
            <span class="glyphicon glyphicon-envelope"></span> Enviar mensaje
        </a>
        <a href="#" class="btn btn-deal" role="button" title="Contraoferta" ng-if="contraoferta">
            <span class="glyphicon glyphicon-transfer"></span> Contraoferta
        </a>
        <a class="btn btn-favorite" ng-click="favorite(tratos._id)" ng-if="defaultFav" role="button" title="Añadir a favoritos">
            <span class="glyphicon glyphicon-star-empty"></span> Añadir a favoritos
        </a>
        <a class="btn btn-warning" ng-if="tratoFav"  role="button" title="Favorito">
            <span class="glyphicon glyphicon-star"></span> Favorito
        </a>
        <a href="#" class="btn btn-phone" role="button" title="Ver teléfono">
            <span class="glyphicon glyphicon-earphone"></span> Ver teléfono
        </a>
        <a href="#" class="btn btn-complaint" role="button" title="Denunciar trato">
            <span class="glyphicon glyphicon-thumbs-down"></span> Denunciar trato
        </a>
    </div>
</script>
</section>
